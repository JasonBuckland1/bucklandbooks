<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <title>Quiz</title>
    <style>
        body {
            font-family: 'Comic Sans MS', 'Arial', sans-serif; 
            background-color: #f0f4f8;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #333;
        }

        .quiz-container {
            max-width: 500px;
            padding: 30px 40px;  
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.1);
        }

        h2 {
            font-size: 1.6em;
            margin-top: 0;
            margin-bottom: 25px;
            font-weight: bold;
        }

        #question {
            font-size: 1.5em;
            margin-bottom: 20px;
            opacity: 1;
        }
        
         #question-image img {
            max-width: 100%;  /* make sure it's not larger than its container */
            height: auto;  /* maintain aspect ratio */
            display: block;  /* removes any unwanted spacing at the bottom */
            margin: 20px auto;  /* center it horizontally, with some margin at the top and bottom */
            border: 2px solid #007BFF;  /* a border, optional */
            border-radius: 5px;  /* rounded corners, optional */
        }

        .choice-btn {
            font-size: 1.2em;
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            background-color: #007BFF;
            color: #ffffff;
            border: none;
            border-radius: 5px;
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease-in-out;
        }

        .choice-btn:hover {
            background-color: #0056b3;
            transform: translateY(-3px);
            box-shadow: 0px 6px 8px rgba(0, 0, 0, 0.1);
        }

        #feedback {
            margin-top: 10px;
            font-weight: bold;
            opacity: 0;
        }

        #timer {
            font-size: 1.2em;
            margin-top: 15px;
            font-weight: bold;
            color: #007BFF;
        }

        .progress-bar {
    background-color: #e0e0e0;
    height: 20px;
    width: 90%;
    margin: 20px auto;
    border-radius: 5px;
    position: relative;  /* Add this line */
}

        .progress-bar-inner {
            height: 100%;
            width: 0;
            background-color: #007BFF;
            transition: width 0.5s ease-out;
        }

        .group-number-display {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
        }

        #end-card {
            opacity: 0;
        }
    </style>
</head>

<body>
    <div class="quiz-container">
        <h2 id="question"></h2>
        <div id="question-image"></div>
        <div id="choices"></div>
        <div id="feedback"></div>
        <div id="score">Score: 0</div>
        <div id="timer">Time left: 5:00</div>
        <div class="progress-bar">
            <div class="progress-bar-inner"></div>
             <div id="group-number" class="group-number-display">Group: 1</div>
        </div>
    </div>
    <div id="end-card" class="quiz-container" style="display: none;">
        <h2>Quiz Ended</h2>
        <p>Correct Answers: <span id="final-score"></span></p>
        <p>Advised Level: <span id="reached-group"></span></p>
        <button id="download-pdf">Download PDF</button>
    </div>
    <script>
        const groups = [
    {
        groupNumber: 0.4,
        totalQuestions: 3,
        questions: [
            { question: "", questionImage: "img/cat.png", choices: ["The dog", "The cat", "The fish"], correctAnswer: 1 },
            { question: "", questionImage: "img/dog.png", choices: ["The dog", "The cat", "The fish"], correctAnswer: 0 },
            { question: "", questionImage: "img/fish.png", choices: ["The dog", "The cat", "The fish"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 0.5,
        totalQuestions: 3,
        questions: [
            { question: "Which element has the chemical symbol 'Au'?", choices: ["Silver", "Gold", "Iron", "Aluminum"], correctAnswer: 1 },
            { question: "What's the world's longest river?", choices: ["Amazon", "Nile", "Mississippi", "Yangtze"], correctAnswer: 1 },
            { question: "Who painted the Mona Lisa?", choices: ["Vincent van Gogh", "Leonardo da Vinci", "Pablo Picasso", "Michelangelo"], correctAnswer: 1 },
        ]
    },
    {
        groupNumber: 0.6,
        totalQuestions: 3,
        questions: [
            { question: "Which country is known as the Land Down Under?", choices: ["New Zealand", "South Africa", "Australia", "Indonesia"], correctAnswer: 2 },
            { question: "In which continent is the Sahara Desert located?", choices: ["Asia", "Australia", "Africa", "North America"], correctAnswer: 2 },
            { question: "What is the capital of Canada?", choices: ["Toronto", "Montreal", "Vancouver", "Ottawa"], correctAnswer: 3 },
        ]
    },
    {
        groupNumber: 0.7,
        totalQuestions: 3,
        questions: [
            { question: "Which planet is the largest in our Solar System?", choices: ["Earth", "Mars", "Jupiter", "Venus"], correctAnswer: 2 },
            { question: "Which bird is known as the symbol of peace?", choices: ["Dove", "Sparrow", "Eagle", "Peacock"], correctAnswer: 0 },
            { question: "How many players are there in a standard football (soccer) team?", choices: ["9", "10", "11", "12"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 0.8,
        totalQuestions: 3,
        questions: [
            { question: "In Greek mythology, who turned all that he touched into gold?", choices: ["Zeus", "Apollo", "Midas", "Ares"], correctAnswer: 2 },
            { question: "Which Shakespearean play is also referred to as 'What You Will'?", choices: ["Twelfth Night", "Macbeth", "Hamlet", "The Tempest"], correctAnswer: 0 },
            { question: "What is the tallest mountain in the world?", choices: ["K2", "Mount Kilimanjaro", "Mount Everest", "Mount McKinley"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 0.9,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 1.0,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 1.1,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 1.2,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 1.3,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 1.4,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 1.5,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 1.6,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 1.7,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 1.8,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 1.9,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 2.0,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 2.1,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 2.2,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 2.3,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 2.4,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 2.5,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 2.6,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 2.7,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 2.8,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 2.9,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 3.0,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 3.1,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 3.2,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 3.3,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 3.4,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 3.5,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 3.6,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 3.7,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 3.8,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 3.9,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 4.0,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 4.1,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 4.2,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 4.3,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 4.4,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 4.5,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 4.6,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 4.7,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 4.8,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 4.9,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 5.0,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 5.1,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 5.2,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 5.3,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 5.4,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 5.5,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 5.6,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 5.7,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 5.8,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 5.9,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 6.0,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 6.1,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 6.2,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 6.3,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 6.4,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 6.5,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 6.6,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 6.7,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 6.8,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
    {
        groupNumber: 6.9,
        totalQuestions: 3,
        questions: [
            { question: "Question", choices: ["a1", "a2", "a3", "a4"], correctAnswer: 2 },
        ]
    },
];
        
        
        const progressBarColors = ['#B2DFDB', '#80CBC4', '#4DB6AC', '#26A69A', '#009688'];
        const feedbackDiv = document.getElementById("feedback");
        let recordedAnswers = [];
        let groupStats = {}; // Object to store statistics for each group
        const groupScoreTracker = {};
        let hasAnswered = false;  // Initialize the hasAnswered state variable


function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

groups.forEach(group => shuffle(group.questions));

let currentGroupIndex = 0;
let score = 0;
let timerStarted = false;  // To check if timer has started
let timeLeft = 5 * 60; // 5 minutes in seconds

function updateTimerDisplay() {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    document.getElementById("timer").textContent = `Time Left: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
}

function updateScore() {
    score++;
    document.getElementById("score").textContent = `Score: ${score}`;
}
        
// Added this function to update the score tracker for each group
function updateGroupScore(isCorrect, groupNumber) {
    if (!groupScoreTracker[groupNumber]) {
        groupScoreTracker[groupNumber] = { correct: 0, total: 0 };
    }
    if (isCorrect) {
        groupScoreTracker[groupNumber].correct++;
    }
    groupScoreTracker[groupNumber].total++;
}

function startTimer() {
    const timerInterval = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            endQuiz();
        }
    }, 1000);
}

function endQuiz() {
    document.querySelector('.quiz-container').style.display = "none";
    const endCard = document.getElementById("end-card");
    endCard.style.display = "block"; // Show the end card
    document.getElementById("final-score").textContent = score;
    document.getElementById("reached-group").textContent = groups[currentGroupIndex].groupNumber;
    setTimeout(() => {
        endCard.style.opacity = "1"; // fade in end card
    }, 500);
}

function getNextQuestion() {
    if (!groups[currentGroupIndex] || groups[currentGroupIndex].questions.length === 0) {
        // If it's the final group and no more questions, reset its questions.
        if (currentGroupIndex === groups.length - 1) {
            shuffle(groups[currentGroupIndex].questions);
            return groups[currentGroupIndex].questions[0];
        }
        endQuiz();
        return null;
    }
    return groups[currentGroupIndex].questions[0];
}


function displayQuestion(q) {
    hasAnswered = false;  // Reset hasAnswered when displaying a new question
    const questionDiv = document.getElementById("question");
    questionDiv.style.opacity = "0"; // fade out current question

      // Display optional question image
    const questionImageDiv = document.getElementById("question-image");
    if (q.questionImage) {
        const img = new Image();
        img.src = q.questionImage;
        questionImageDiv.innerHTML = '';
        questionImageDiv.appendChild(img);
    } else {
        questionImageDiv.innerHTML = '';
    }
    
setTimeout(() => {
        questionDiv.textContent = q.question;
        questionDiv.style.opacity = "1"; // fade in new question

        const choicesDiv = document.getElementById("choices");
        choicesDiv.innerHTML = '';
        
        q.choices.forEach((c, i) => {
            const btn = document.createElement("button");
            btn.className = "choice-btn";
            
            if (typeof c === "string") {
                btn.textContent = c;
            } else {
                // Handle choice objects with optional image
                btn.textContent = c.text;
                if (c.image) {
                    const img = new Image();
                    img.src = c.image;
                    img.alt = c.text;
                    btn.appendChild(img);
                }
            }
            
            btn.onclick = () => checkAnswer(i, q);
            choicesDiv.appendChild(btn);
        });
    }, 500);
}

function setProgressBarColor() {
    const innerBar = document.querySelector('.progress-bar-inner');
    innerBar.style.backgroundColor = progressBarColors[currentGroupIndex] || progressBarColors[progressBarColors.length - 1];
}

function updateProgressBar() {
    const percentage = ((currentGroupIndex + 1) / groups.length) * 100;
    document.querySelector('.progress-bar-inner').style.width = `${percentage}%`;
    document.getElementById('group-number').textContent = `Group: ${groups[currentGroupIndex].groupNumber}`;
    setProgressBarColor();
}


function checkAnswer(choice, question) {
     if (hasAnswered) return;  // Exit if hasAnswered is true
    hasAnswered = true;  // Set hasAnswered to true
    const currentGroupNumber = groups[currentGroupIndex].groupNumber;  // Store current group

    // Start timer when user attempts first question
    if (!timerStarted) {
        startTimer();
        timerStarted = true;
    }

    const correct = question.correctAnswer === choice;
    groups[currentGroupIndex].questions.shift(); // Remove the question

    if (correct) {
        feedbackDiv.textContent = "Correct!";
        feedbackDiv.style.color = "green";
        feedbackDiv.style.opacity = "1"; 

        // Update the score when the answer is correct
        updateScore();  // <-- This line is added to update the score

        if (currentGroupIndex < groups.length - 1) {
            currentGroupIndex++; 
        }
    } else {
        feedbackDiv.textContent = "Wrong!";
        feedbackDiv.style.color = "red";
        feedbackDiv.style.opacity = "1"; 
        if (currentGroupIndex > 0) {
            currentGroupIndex--;
        }
    }

    if (currentGroupIndex === groups.length - 1 && !groups[currentGroupIndex].questions.length) {
        endQuiz();
        return; // Early exit, since we don't want to proceed further
    }

    setTimeout(() => {
        feedbackDiv.textContent = '';
        feedbackDiv.style.opacity = "0"; 

        const nextQuestion = getNextQuestion();
        if (nextQuestion) {
            displayQuestion(nextQuestion);
        }
    }, 1000);
    
    const userAnswer = {
        groupNumber: currentGroupNumber, // Use stored group number
        question: question.question,
        userChoice: question.choices[choice],
        correctAnswer: question.choices[question.correctAnswer],
        isCorrect: correct
    };
    recordedAnswers.push(userAnswer);

    updateProgressBar();
    
    // Update group score statistics
    updateGroupScore(userAnswer.isCorrect, currentGroupNumber);  // Use stored group number
}

const initialQuestion = getNextQuestion();
if (initialQuestion) {
    displayQuestion(initialQuestion);
}

updateProgressBar();
        
document.getElementById("download-pdf").addEventListener('click', function() {
    // Prompt the user to enter their name
    const studentName = prompt("Please enter your name:", "");
    
    // Check if the user pressed Cancel on the prompt
    if (studentName === null) {
        return; // Exit the function
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    let yPos = 20;
    
    const levelScoreTracker = {
    'Level 1': { correct: 0, total: 0 },
    'Level 2': { correct: 0, total: 0 },
    'Level 3': { correct: 0, total: 0 },
    'Level 4': { correct: 0, total: 0 },
    'Level 5': { correct: 0, total: 0 },
    'Level 6': { correct: 0, total: 0 },
    'Level 7': { correct: 0, total: 0 },
    'Level 8': { correct: 0, total: 0 },
    'Level Advanced': { correct: 0, total: 0 },
    
};
    
    function getPercentageColor(percentage) {
  let r, g, b;
  if (percentage < 50) {
    r = 255;
    g = Math.floor((percentage / 50) * 255);
    b = 0;
  } else {
    g = 255;
    r = Math.floor((1 - ((percentage - 50) / 50)) * 255);
    b = 0;
  }
  return [r, g, b];
}
    
    
// Function to check if we need a new page
function checkPageOverflow(yPos, pageHeight, bottomMargin) {
    if (yPos >= pageHeight - bottomMargin) {
        doc.addPage();
        return 20; // Reset yPos to the top margin of the new page
    }
    return yPos;
}    
    
    // Initialize page height and margin for better positioning
const pageHeight = doc.internal.pageSize.getHeight(); // Get page height
const bottomMargin = 20; // Set a bottom margin
    
     function addFriendlyContent(doc, yPos) {
    }

    // Title
    doc.setFontSize(24);
    doc.setFont('helvetica', 'bold');
    doc.text('Quiz Results', 105, yPos, null, null, 'center');
    yPos += 10;
    
    // Draw Thick divider
    doc.setLineWidth(1);
    doc.line(10, yPos, 200, yPos);
    yPos += 10; // Increased space

    // Student Name
    doc.setFontSize(16);
    doc.setFont('helvetica', 'normal');
    doc.text(`Student Name: ${studentName}`, 10, yPos);
    const savedYPosForRecommendation = yPos;  // Save this yPos for later
    yPos += 10;

    // Draw divider
    doc.setLineWidth(0.5);
    doc.line(10, yPos, 200, yPos);
    yPos += 10;
    
    
    
// Save the current yPos for later use (Start of Summary)
const summaryYPos = yPos;

   // Draw "Summary"
doc.setFontSize(16);
doc.setFont('helvetica', 'normal');
doc.text(`Summary`, 10, yPos);
yPos += 7;
doc.setFontSize(12);
const totalQuestions = recordedAnswers.length;
const correctAnswers = recordedAnswers.filter(answer => answer.isCorrect).length;
const overallPercentage = Math.round((correctAnswers / totalQuestions) * 100);  // Rounded to the nearest integer
doc.text(`Total Questions: ${totalQuestions}`, 10, yPos);
yPos += 7;
doc.text(`Correct Answers: ${correctAnswers}`, 10, yPos);
yPos += 7;
doc.text(`Percentage: ${overallPercentage}%`, 10, yPos);
yPos += 10;

// Add Buckland level information (right column)
doc.text('Level 1 = 0.4-0.6, Level 2 = 0.7-0.9', 10, yPos);
yPos += 7;
doc.text('Level 3 = 1.0-1.4, Level 4 = 1.5-1.9', 10, yPos);
yPos += 7;
doc.text('Level 5 = 2.0-2.9, Level 6 = 3.0-3.9', 10, yPos);
yPos += 7;
doc.text('Level 7 = 4.0-4.9, Level 8 = 5.0-5.9', 10, yPos);
yPos += 7;
doc.text('Level Advanced = 6+', 10, yPos);    

// Draw a vertical line separating "Summary" and "Level Guidance"
const levelGuidanceXPos = 110; 
doc.setLineWidth(0.5);
doc.line(levelGuidanceXPos, summaryYPos, levelGuidanceXPos, yPos + 5);  // Adjust the line height as needed

// Reset yPos to the stored position for "Level Guidance" (same vertical start as Summary)
yPos = summaryYPos;

// Write "Level Guidance" content
doc.setFontSize(16);
doc.text('Level Guidance', levelGuidanceXPos + 10, yPos); // Positioned to the right
yPos += 10;

doc.setFontSize(12);
doc.text('95% - 100%: Next Stage Ready', levelGuidanceXPos + 10, yPos);
yPos += 7;
doc.text('90% - 94%: Nearly Next Stage Ready', levelGuidanceXPos + 10, yPos);
yPos += 7;
doc.text('85% - 89%: Mastered', levelGuidanceXPos + 10, yPos);
yPos += 7;
doc.text('80% - 84%: Nearly Mastered', levelGuidanceXPos + 10, yPos);
yPos += 7;
doc.text('70% - 79%: Developing', levelGuidanceXPos + 10, yPos);
yPos += 7;
doc.text('60% - 69%: Needs Attention', levelGuidanceXPos + 10, yPos);
yPos += 7;
doc.text('40% - 59%: Emerging', levelGuidanceXPos + 10, yPos);
yPos += 7;
doc.text('0% - 39%: No Competency', levelGuidanceXPos + 10, yPos);
yPos += 7;
    // Draw divider
    doc.setLineWidth(1);
    doc.line(10, yPos, 200, yPos);
    yPos += 12;
    
    
function getGuidance(percentage) {
  if (percentage >= 95) return 'Next Stage Ready';
  if (percentage >= 90) return 'Nearly Next Stage Ready';
  if (percentage >= 85) return 'Mastered';
  if (percentage >= 80) return 'Nearly Mastered';
  if (percentage >= 70) return 'Developing';
  if (percentage >= 60) return 'Needs Attention';
  if (percentage >= 40) return 'Emerging';
  return 'No Competency';
}
    
   // Group-wise score
  doc.setFontSize(18);
  doc.text('Group Wise Score:', 10, yPos);
  yPos += 10;
  doc.setFontSize(12);
  for (const [groupNumber, stats] of Object.entries(groupScoreTracker)) {
    yPos = checkPageOverflow(yPos, pageHeight, bottomMargin);
      const percentage = Math.round((stats.correct / stats.total) * 100);  // Rounded to the nearest integer
      
       // Get the appropriate guidance text
  const guidanceText = getGuidance(percentage);
      
      const getPercentageColor = (percentage) => {
  if (percentage >= 95) return [0, 128, 0];  // Dark green for "Next Stage Ready"
  if (percentage >= 90) return [0, 255, 0];  // Light green for "Nearly Next Stage Ready"
  if (percentage >= 85) return [255, 255, 0];  // Yellow for "Mastered"
  if (percentage >= 80) return [255, 223, 0];  // Light yellow for "Nearly Mastered"
  if (percentage >= 70) return [255, 165, 0];  // Orange for "Developing"
  if (percentage >= 60) return [255, 99, 71];  // Tomato color for "Needs Attention"
  if (percentage >= 40) return [255, 0, 0];  // Red for "Emerging"
  return [128, 0, 0];  // Dark red for "No Competency"
};
      
      // Add a colored rectangle marker based on percentage
      const color = getPercentageColor(percentage);
      doc.setFillColor(color[0], color[1], color[2]);
      doc.rect(190, yPos - 5, 5, 5, 'F');

      // Include the guidance text next to the percentage
  doc.text(`Group ${groupNumber} - Correct Answers: ${stats.correct}, Total Questions: ${stats.total}, Percentage: ${percentage}% (${guidanceText})`, 10, yPos);
  yPos += 7;
      
      if (['0.4', '0.5', '0.6'].includes(groupNumber)) {
        levelScoreTracker['Level 1'].correct += stats.correct;
        levelScoreTracker['Level 1'].total += stats.total;
    } else if (['0.7', '0.8', '0.9'].includes(groupNumber)) {
        levelScoreTracker['Level 2'].correct += stats.correct;
        levelScoreTracker['Level 2'].total += stats.total;
    }else if (['1.0', '1.1', '1.2', '1.3', '1.4'].includes(groupNumber)) {
        levelScoreTracker['Level 3'].correct += stats.correct;
        levelScoreTracker['Level 3'].total += stats.total;
    }else if (['1.5', '1.6', '1.7', '1.8', '1.9'].includes(groupNumber)) {
        levelScoreTracker['Level 4'].correct += stats.correct;
        levelScoreTracker['Level 4'].total += stats.total;
    }else if (['2.0', '2.1', '2.2', '2.3', '2.4', '2.5', '2.6', '2.7', '2.8', '2.9'].includes(groupNumber)) {
        levelScoreTracker['Level 5'].correct += stats.correct;
        levelScoreTracker['Level 5'].total += stats.total;
    }else if (['3.0', '3.1', '3.2','3.3', '3.4', '3.5', '3.6', '3.7', '3.8', '3.9'].includes(groupNumber)) {
        levelScoreTracker['Level 6'].correct += stats.correct;
        levelScoreTracker['Level 6'].total += stats.total;
    }else if (['4.0', '4.1', '4.2', '4.3', '4.4', '4.5', '4.6', '4.7', '4.8', '4.9'].includes(groupNumber)) {
        levelScoreTracker['Level 7'].correct += stats.correct;
        levelScoreTracker['Level 7'].total += stats.total;
    }else if (['5.0', '5.1', '5.2', '5.3', '5.4', '5.5', '5.6', '5.7', '5.8', '5.9'].includes(groupNumber)) {
        levelScoreTracker['Level 8'].correct += stats.correct;
        levelScoreTracker['Level 8'].total += stats.total;
    }else if (['6.0', '6.1', '6.2', '6.3', '6.4', '6.5', '6.6', '6.7', '6.8', '6.9'].includes(groupNumber)) {
        levelScoreTracker['Level Advanced'].correct += stats.correct;
        levelScoreTracker['Level Advanced'].total += stats.total;
    }
    // Add more 'else if' conditions for other levels
  }
    
   // Draw divider
doc.setLineWidth(1);
doc.line(10, yPos, 200, yPos);
yPos += 10;
    
// Level-wise score
doc.setFontSize(16);
doc.text('Level Wise Score:', 10, yPos);
yPos += 7;
doc.setFontSize(12);

// Loop through the levelScoreTracker object
for (const [levelName, stats] of Object.entries(levelScoreTracker)) {
    yPos = checkPageOverflow(yPos, pageHeight, bottomMargin);

    // Only include the level if questions have been attempted (stats.total > 0)
    if (stats.total > 0) {
        let percentage = Math.round((stats.correct / stats.total) * 100);  // Rounded to the nearest integer

        // Get the appropriate guidance text
        const guidanceText = getGuidance(percentage);
        
        const getPercentageColor = (percentage) => {
  if (percentage >= 95) return [0, 128, 0];  // Dark green for "Next Stage Ready"
  if (percentage >= 90) return [0, 255, 0];  // Light green for "Nearly Next Stage Ready"
  if (percentage >= 85) return [255, 255, 0];  // Yellow for "Mastered"
  if (percentage >= 80) return [255, 223, 0];  // Light yellow for "Nearly Mastered"
  if (percentage >= 70) return [255, 165, 0];  // Orange for "Developing"
  if (percentage >= 60) return [255, 99, 71];  // Tomato color for "Needs Attention"
  if (percentage >= 40) return [255, 0, 0];  // Red for "Emerging"
  return [128, 0, 0];  // Dark red for "No Competency"
};

        // Add a colored rectangle marker based on percentage
        const color = getPercentageColor(percentage);
        doc.setFillColor(color[0], color[1], color[2]);
        doc.rect(190, yPos - 5, 5, 5, 'F');

        // Include the guidance text next to the percentage
        doc.text(`${levelName} - Correct Answers: ${stats.correct}, Total Questions: ${stats.total}, Percentage: ${percentage}% (${guidanceText})`, 10, yPos);
        yPos += 7;
    }
}
    
     // Draw divider
doc.setLineWidth(1);
doc.line(10, yPos, 200, yPos);
yPos += 10;
    
yPos = checkPageOverflow(yPos, pageHeight, bottomMargin);    
    
// Calculate recommended level
let recommendedLevel = "None";
let highestPercentage = 0;
for (const [levelName, stats] of Object.entries(levelScoreTracker)) {
    let percentage = 0;  // Default value
    if (stats.total > 0) {
        // Calculate the percentage if stats.total is not zero to avoid NaN
        percentage = Math.round((stats.correct / stats.total) * 100);
    }
    if (percentage > highestPercentage) {
        highestPercentage = percentage;
        recommendedLevel = levelName;
    }
}

// If the highest percentage is above a certain threshold, recommend the next level
if (highestPercentage > 75) {
    // Logic to get next level, assuming your levels are named 'Level 1', 'Level 2', etc.
    if (recommendedLevel === 'Level Advanced') {
        // If they're already at the highest level, perhaps you don't recommend a next level
    } else {
        let currentLevelNumber = parseInt(recommendedLevel.split(' ')[1]); // Extract the number part from "Level X"
        let nextLevelNumber = currentLevelNumber + 1;
        recommendedLevel = 'Level ' + nextLevelNumber;
    }
}
    
// Go back to the yPos where the student name was written
yPos = savedYPosForRecommendation;


// Print the recommended level
doc.setFontSize(16);
doc.text(`Recommended Level: ${recommendedLevel}`, 110, yPos);
yPos += 7;

// Save the current yPos for later use
const savedYPos = yPos;
    
// Reset yPos to where it was before, so that the next text column aligns properly
yPos = savedYPos;



    // Footer
    const currentDate = new Date();
    doc.setFontSize(10);
    doc.text(`Date: ${currentDate.toDateString()}`, 10, doc.internal.pageSize.getHeight() - 10);
    
      // Add the student/parent-friendly content as a new page
    addFriendlyContent(doc, yPos);

    doc.save("Quiz-Results.pdf");
});

    </script>
</body>

</html>